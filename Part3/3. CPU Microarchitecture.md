# 3 CPU 微架构

本章节提供了对影响性能的关键 CPU 架构和微架构特性的简要总结。本章的目标不是涵盖 CPU 架构的详细信息和权衡，这些已在文献中广泛讨论[Hennessy and Patterson, 2011]。我们将快速回顾对软件性能产生直接影响的 CPU 硬件特性。

## 3.1 指令集架构

指令集是软件用于与硬件通信的词汇。指令集架构（ISA）定义了软件和硬件之间的约定。Intel x86、ARM v8、RISC-V 是当前广泛部署的 ISA 的例子。所有这些都是 64 位架构，即所有地址计算都使用 64 位。ISA 开发者通常确保符合规范的软件或固件将在使用规范构建的任何处理器上执行。广泛部署的 ISA 版本通常确保向后兼容，以确保为处理器的 GenX 版本编写的代码将继续在 GenX+i 上执行。

大多数现代架构都可以被分类为通用寄存器为基础的，采用 Load-Store 架构的体系结构，其中操作数是明确指定的，内存只能使用加载和存储指令访问。除了在 ISA 中提供基本功能（如加载、存储、控制、使用整数和浮点数进行标量算术运算），广泛部署的架构继续增强其 ISA 以支持新的计算范例。这些包括增强的矢量处理指令（例如，Intel AVX2、AVX512，ARM SVE）和矩阵/张量指令（Intel AMX）。映射到使用这些高级指令的软件通常在性能上提供数量级的改进。

随着深度学习领域的快速发展，行业对于用于推动显著性能改进的变量的替代数值格式重新产生了兴趣。研究表明，使用更少的位来表示变量，既能保持深度学习模型表现良好，又能节省计算和内存带宽。因此，近期一些 CPU 系列已经添加了对低精度数据类型的支持，例如 8 位整数（int8，例如，Intel VNNI），16 位浮点数（fp16，bf16），除了传统的 32 位和 64 位格式。

## 3.2 流水线处理

流水线处理是用于加速 CPU 的基础技术，其中多个指令在执行期间重叠。CPU 中的流水线处理从汽车装配线中得到灵感。指令的处理被划分为阶段。这些阶段并行操作，在不同指令的不同部分上工作。DLX 是一个由[Hennessy and Patterson, 2011]定义的简单的 5 阶段流水线的示例，包括：
1. 指令提取（IF）
2. 指令解码（ID）
3. 执行（EXE）
4. 存储访问（MEM）
5. 写回（WB）

